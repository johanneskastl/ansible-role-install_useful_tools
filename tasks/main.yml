---
# tasks file for install_useful_tools


#
# add tmux where available
#
- name: "Add package tmux on Debian"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['tmux']"
  when: 'ansible_distribution == "Debian"'

- name: "Add package tmux on Fedora"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['tmux']"
  when: 'ansible_distribution == "Fedora"'

- name: "Add package tmux on openSUSE"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['tmux']"
  when: 'ansible_distribution == "openSUSE Leap" or ansible_distribution == "openSUSE MicroOS"'

#
# add git where available
#
- name: "Add package git on Debian"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['git']"
  when: 'ansible_distribution == "Debian"'

- name: "Add package git on Fedora"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['git']"
  when: 'ansible_distribution == "Fedora"'

- name: "Add package git-core on openSUSE"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['git-core']"
  when: 'ansible_distribution == "openSUSE Leap" or ansible_distribution == "openSUSE MicroOS"'

#
# add netcat where available
#
- name: "Add package nmap-ncat on CentOS/RedHat"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['nmap-ncat']"
  when: 'ansible_os_family == "RedHat"'

- name: "Add package netcat-openbsd on *SUSE"
  set_fact:
    useful_tools: "{{ useful_tools }} + ['netcat-openbsd']"
  when: 'ansible_os_family == "Suse"'

#
# install the tools
#
- name: "Install useful tools"
  package:
    name: "{{ useful_tools }}"
    state: "present"
  when: 'ansible_distribution != "openSUSE MicroOS"'

- name: "Install useful tools on openSUSE MicroOS"
  command:
  args:
  command: '/usr/sbin/transactional-update --non-interactive pkg install {{ useful_tools | join(" ") }}'
  when: 'ansible_distribution == "openSUSE MicroOS"'
  notify:
    - 'Reboot'
    - 'Wait for the machine(s) to be ready again'
